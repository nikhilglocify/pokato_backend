// Prisma Schema for Stripe Connect Terminal App
// Only users and stripe_details tables

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - corresponds to Firestore 'users' collection
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  displayName       String?
  stripeAccountId   String?  @unique
  stripeAccountStatus String? @default("not_connected") // 'pending' | 'active' | 'disabled' | 'not_connected'
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  stripeDetails     StripeDetails?

  @@index([stripeAccountId])
  @@map("users")
}

// Stripe Details - corresponds to Firestore 'stripe_details' collection
// Stores sensitive OAuth tokens separately
model StripeDetails {
  id                 String   @id @default(uuid())
  userId             String   @unique
  stripeAccountId    String   @unique
  stripeAccountStatus String  @default("not_connected")
  stripePublishableKey String?
  stripeAccessToken  String   // OAuth access token (encrypted in production)
  stripeRefreshToken String   // OAuth refresh token (encrypted in production)
  stripeScope        String
  stripeTokenType    String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([stripeAccountId])
  @@map("stripe_details")
}
